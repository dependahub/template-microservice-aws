import fs from 'node:fs/promises';
import {kekabToCamel} from '../utils/text-transform.js';

export async function makeActionsIndex(actionsPath) {
	const indexJs = `${actionsPath}/index.js`;
	const dirents = await fs.readdir(actionsPath, {withFileTypes: true});
	const actions = dirents
		.filter(d =>
			d.isFile()
			&& d.name.endsWith('.js')
			&& !d.name.endsWith('.spec.js')
			&& !d.name.endsWith('.test.js')
			&& d.name !== 'index.js')
		.map(d => ({
			fileName: d.name,
			functionName: kekabToCamel(d.name.replace('.js', '')),
		}));

	const content = [
		`
/**
 * !! DO NOT EDIT MANUALLY !!
 * This file is generated by sdk/scripts/build/scripts/build/actions/make-actions-index.js
 */
`.trim(),
		'',
		actions.map(a => `export * from './${a.fileName}';`).join('\n'),
	].join('\n') + '\n';

	await fs.writeFile(indexJs, content);
}
